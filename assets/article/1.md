这里总结一下我在工作中遇到的微信小程序中的问题

这个是官方的buglist[微信小程序buglist](https://developers.weixin.qq.com/community/develop/buglist)

### 问题1

今天用canvas绘制一个图片，然后保存到手机本地，canvas宽375，高667，但是保存到本地的图片总是缺少最下面的一部分。

**wxml代码如下：**

```html
<canvas canvas-id="mycanvas" style="width:375px;height:667px"/>
```

找了好久没找到问题所在，后来发现用手机屏幕比较大的就可以正确保存下来（大于375px*667px），再后来考虑是不是图片被什么东西给截断了，后来尝试把wxml代码改成如下：

```html
<view><canvas canvas-id="mycanvas" style="width:375px;height:667px"/></view>
```

无论什么机型的手机都可以正确保存了，不知道是小程序的bug还是canvas就是要这么用，不过确实可以解决这个问题。

最好不要直接用canvas进行展示，会有一些样式的问题。

### 问题2

在做项目的过程中使用微信的小程序将canvas保存为本地的图片，本来以为没什么难度，但是在华为p20上出现了字体和预期不一致的结果，其他手机暂时没测出问题，目前为止也没找到问题所在

### 问题3（已向微信小程序官方提交bug）（已解决，官方建议升级微信版本，这个bug在后面额版本中已经修复）

复现环境：VIVO Z1手机，系统版本8.1.0，微信版本6.6.2。app跳转到小程序之后，点击小程序中的跳转回app的按钮没反应，binderror报错，invalid scene。

### 问题4（已解决）

这个问题是我认为最大的问题，使用wepy框架开发微信小程序，页面A有两种方式跳转页面B，一种是这种：

```js
wx.navigateTo({
    url: 'pages/b/b?data=haha'
})
```

一种是：

```js
wx.navigateTo({
    url: 'pages/b/b'
})
```

页面B用这种方式来接受A穿过来的参数：

```js
onLoad(options){
    if(options.data){
        this.data = haha;
    }
}
```

并且页面B展示data的值，我们第一次跳转的时候使用带参数的方式跳转，页面B中显示的是haha，然后点击返回按钮，返回到页面A。然后再利用第二种跳转方式跳转页面B，这时页面B中依然显示haha。这不津让我认为页面B中的数据并没有销毁。我认为这是不对的呀。现在的解决方法是只能在页面B中的onUnLoad事件中添加数据的行为，并且还要在最后添加这行代码才可以：

```js
this.$apply();
```

上面的解决方案在某些安卓手机上不生效，只能通过在onLoad中进行变量的重置，重置后在进行变量的赋值。

我认为这应该是一个bug，在利用原生的微信小程序进行开发时并没有遇到这个问题。我在wepy的github的issue里面发现已经有人提交了类似的issue，开发者已经给出了回复，解决方案如下：

**node_modules/wepy/lib/util.js 的$copy函数中的''+obj==='null'改成obj === null，然后重新编译就能自动清除data了**

### 问题5

正常web开发，cookie是不需要我们手动处理的，但是微信小程序的cookie需要我们手动存下来，然后每次请求的时候去手动带上进行http请求。

### 问题6

input输入框中的placeholder当获得焦点的时候会闪一下，而且input有很多默认的样式，button也有很多默认的样式。

### 问题7

使用swiper组件查看图片，图片资源是从服务端返回的url数组，比如返回了两个图片，我们翻到第二页，然后下拉刷新，这时服务器可能只返回一个url，这时swiper组件就只显示一个空白，也不能翻到第一页了。

### 问题8

多个层级使用margin-top会导致页面上部出现意想不到的空白，感觉像是margin-top再叠加，而不是取最大者。

### 问题9

在onReady中获取某个view的高度不准，必须要加setTimeout延迟获取。

### 注意点1

image标签可以添加error事件监听，当图片加载失败时会触发这个事件。

### 注意点2

微信小程序的页面栈最多只能有10个，达到10个后就无法继续进行路由跳转了。所以如果存在页面层级较多，或者是页面存在某几个可以进行来回跳转的就要注意这个问题了。当你发现无法进行页面跳转了就要考虑考虑是不是这个问题引起的。

### 注意点3

多个页面引入同一个文件时，该文件内的变量会共享。

#### 注意点4

尽量不要在onLoad中写逻辑，我们公司的测试这样操作，进入小程序正常测试，点击右上角的后台，然后从其他的途径马上再进小程序（从他人的分享等等），这种时候有可能就不会在走onLoad的逻辑，导致出错。可以尝试在onShow中写页面的开始逻辑。

### 注意点5

小程序的picker组件，在安卓手机上在轮播选择时会出现条目循环。

### 注意点6

小程序不支持nth-child选择器，但是支持first-child选择器。

### 注意点7

生成小程序二维码携带参数有多种解析形式，一种是正常我们在url后面的searchParms，例如/api?data=5,另一种形式是我们需要`decodeURIComponent(query.scene)`才能拿到我们字符串形式的searchParams，然后我们自己对字符串进行解析才能拿到我们要的参数。这两个有什么不同呢？为什么不都使用第一种方式呢，因为第一种方式生成的二维码的个数有限，适用于生成业务比较少的场景，而第二种方式比较麻烦，但是生成的二维码数量没有限制，适用于生成业务比较多的场景。